
<!DOCTYPE HTML>
<html lang="">
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>REST API &#xB7; GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="rest-api.html">
    
    
    <link rel="prev" href="language-reference.html">
    

    </head>
    <body>
        
<div class="book"><div class="_doc--header">
  <div class="header _doc--container">

      <div class="_doc--logo header--logo">
        <a class="header--logo-link" href="/">
          <img class="header--logo-image" src="images/opa-logo.svg" alt="">
          <p class="header--logo-txt">
            Open Policy Agent
          </p>
        </a>
      </div>

      <div class="_doc--menu-mobile">
        <button class="hamburger hamburger--spring" type="button" style="outline: none; padding-bottom: 8px;">
          <span class=" hamburger-box">
            <span class="menu-mobile--hamburger-inner hamburger-inner"></span>
          </span>
        </button>
      </div>

      <div class="_doc--menu-desktop header--menu">
        <a class="header--link header--link_LONG" href="/docs/">
          <p class="header--menu-txt">
            Documentation
          </p>
        </a>
        <a class="header--link header--link_LONG" href="/docs/get-started.html">
          <p class="header--menu-txt">
            Tutorials
          </p>
        </a>
        <a class="header--link header--social-link" href="https://blog.openpolicyagent.org/" target="_blank">
          <img class="header--menu-image" src="images/Medium.svg" alt="">
        </a>
        <a class="header--link header--social-link" href="https://github.com/open-policy-agent/opa" target="_blank">
          <img class="header--menu-image" src="images/Github.svg" alt="">
        </a>
        <a class="header--link header--social-link" href="http://slack.openpolicyagent.org" target="_blank">
          <img class="header--menu-image" src="images/Slack.svg" alt="">
        </a>
      </div>

  </div>
</div>

<div class="_doc--hamburger-menu-container">

  <a class="header--hamburger-menu-link" href="/docs">
    <li class="header--hamburger-menu-item">
      <p class="header--menu-txt">
        Documentation
      </p>
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="/docs/get-started.html">
    <li class="header--hamburger-menu-item">
      <p class="header--menu-txt">
        Tutorials
      </p>
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="https://blog.openpolicyagent.org/" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Medium.svg" alt="">
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="https://github.com/open-policy-agent/opa" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Github.svg" alt="">
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="http://slack.openpolicyagent.org/" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Slack.svg" alt="">
    </li>
  </a>


</div>

    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="./">
            
                <a href="./#what-is-policy">
            
                    
                    What is Policy?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="./">
            
                <a href="./#what-is-policy-enablement">
            
                    
                    What is Policy Enablement?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="./">
            
                <a href="./#what-is-opa">
            
                    
                    What is OPA?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="./">
            
                <a href="./#why-use-opa">
            
                    
                    Why use OPA?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html">
            
                    
                    How Does OPA Work?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#overview">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#deployment">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#data-and-policies">
            
                    
                    Data and Policies
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#base-documents">
            
                    
                    Base Documents
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#policies">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#virtual-documents">
            
                    
                    Rules and Virtual Documents
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#the-data-document">
            
                    
                    The data Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#the-input-document">
            
                    
                    The input Document
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#putting-it-all-together">
            
                    
                    Putting It All Together
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#future-features">
            
                    
                    Future Features
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html">
            
                    
                    How Do I Write Policies?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#what-is-rego">
            
                    
                    What is Rego?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#why-use-rego">
            
                    
                    Why use Rego?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#the-basics">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#scalar-values">
            
                    
                    Scalar Values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#composite-values">
            
                    
                    Composite Values
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#sets">
            
                    
                    Sets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#variables">
            
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#references">
            
                    
                    References
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#variable-keys">
            
                    
                    Variable Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#multiple-expressions">
            
                    
                    Multiple Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#self-joins">
            
                    
                    Self-Joins
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#comprehensions">
            
                    
                    Comprehensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.8.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#array-comprehensions">
            
                    
                    Array Comprehensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#object-comprehensions">
            
                    
                    Object Comprehensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#set-comprehensions">
            
                    
                    Set Comprehensions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#rules">
            
                    
                    Rules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.9.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#generating-sets">
            
                    
                    Generating Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#generating-objects">
            
                    
                    Generating Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#incremental-definitions">
            
                    
                    Incremental Definitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.4" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#complete-definitions">
            
                    
                    Complete Definitions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#functions">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#negation">
            
                    
                    Negation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#modules">
            
                    
                    Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.12.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#comments">
            
                    
                    Comments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#imports">
            
                    
                    Imports
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#with-keyword">
            
                    
                    With Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#default-keyword">
            
                    
                    Default Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#else-keyword">
            
                    
                    Else Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#operators">
            
                    
                    Operators
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.16.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#equality">
            
                    
                    Equality
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#inequality">
            
                    
                    Inequality
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.17" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#built-in-functions">
            
                    
                    Built-in Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#example-data">
            
                    
                    Example Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="language-reference.html">
            
                <a href="language-reference.html">
            
                    
                    Language Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="language-reference.html">
            
                <a href="language-reference.html#built-in-functions">
            
                    
                    Built-in Functions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="language-reference.html">
            
                <a href="language-reference.html#inequality">
            
                    
                    Inequality
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="language-reference.html">
            
                <a href="language-reference.html#numbers">
            
                    
                    Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="language-reference.html">
            
                <a href="language-reference.html#aggregates">
            
                    
                    Aggregates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="language-reference.html">
            
                <a href="language-reference.html#sets">
            
                    
                    Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="language-reference.html">
            
                <a href="language-reference.html#strings">
            
                    
                    Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="language-reference.html">
            
                <a href="language-reference.html#types">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.7" data-path="language-reference.html">
            
                <a href="language-reference.html#encoding">
            
                    
                    Encoding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.8" data-path="language-reference.html">
            
                <a href="language-reference.html#tokens">
            
                    
                    Tokens
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.9" data-path="language-reference.html">
            
                <a href="language-reference.html#time">
            
                    
                    Time
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="language-reference.html">
            
                <a href="language-reference.html#reserved-names">
            
                    
                    Reserved Names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="language-reference.html">
            
                <a href="language-reference.html#grammar">
            
                    
                    Grammar
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="rest-api.html">
            
                <a href="rest-api.html">
            
                    
                    REST API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="rest-api.html">
            
                <a href="rest-api.html#policy-api">
            
                    
                    Policy API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="rest-api.html">
            
                <a href="rest-api.html#list-policies">
            
                    
                    List Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-policy">
            
                    
                    Get a Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="rest-api.html">
            
                <a href="rest-api.html#create-or-update-a-policy">
            
                    
                    Create or Update a Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="rest-api.html">
            
                <a href="rest-api.html#delete-a-policy">
            
                    
                    Delete a Policy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="rest-api.html">
            
                <a href="rest-api.html#data-api">
            
                    
                    Data API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document">
            
                    
                    Get a Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document-with-input">
            
                    
                    Get a Document (with Input)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document-webhook">
            
                    
                    Get a Document (Webhook)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="rest-api.html">
            
                <a href="rest-api.html#create-or-overwrite-a-document">
            
                    
                    Create or Overwrite a Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="rest-api.html">
            
                <a href="rest-api.html#patch-a-document">
            
                    
                    Patch a Document
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="rest-api.html">
            
                <a href="rest-api.html#query-api">
            
                    
                    Query API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="rest-api.html">
            
                <a href="rest-api.html#execute-a-simple-query">
            
                    
                    Execute a Simple Query
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="rest-api.html">
            
                <a href="rest-api.html#execute-an-ad-hoc-query">
            
                    
                    Execute an Ad-hoc Query
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="rest-api.html">
            
                <a href="rest-api.html#authentication">
            
                    
                    Authentication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.4.1" data-path="rest-api.html">
            
                <a href="rest-api.html#bearer-tokens">
            
                    
                    Bearer Tokens
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="rest-api.html">
            
                <a href="rest-api.html#errors">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="rest-api.html">
            
                <a href="rest-api.html#explanations">
            
                    
                    Explanations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="rest-api.html">
            
                <a href="rest-api.html#trace-events">
            
                    
                    Trace Events
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="rest-api.html">
            
                <a href="rest-api.html#performance-metrics">
            
                    
                    Performance Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="rest-api.html">
            
                <a href="rest-api.html#diagnostics">
            
                    
                    Diagnostics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="rest-api.html">
            
                <a href="rest-api.html#watches">
            
                    
                    Watches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="deployments.html">
            
                <a href="deployments.html">
            
                    
                    Deployments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="deployments.html">
            
                <a href="deployments.html#docker">
            
                    
                    Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="deployments.html">
            
                <a href="deployments.html#running-with-docker">
            
                    
                    Running with Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="deployments.html">
            
                <a href="deployments.html#kubernetes">
            
                    
                    Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="deployments.html">
            
                <a href="deployments.html#kicking-the-tires">
            
                    
                    Kicking the Tires
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="security.html">
            
                <a href="security.html">
            
                    
                    Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="security.html">
            
                <a href="security.html#tls-and-https">
            
                    
                    TLS &amp; HTTPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="security.html">
            
                <a href="security.html#authentication-and-authorization">
            
                    
                    Authentication &amp; Authorization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Tutorials</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="get-started.html">
            
                <a href="get-started.html">
            
                    
                    Get Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="docker-authorization.html">
            
                <a href="docker-authorization.html">
            
                    
                    Docker Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="http-api-authorization.html">
            
                <a href="http-api-authorization.html">
            
                    
                    HTTP API Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="ssh-and-sudo-authorization.html">
            
                <a href="ssh-and-sudo-authorization.html">
            
                    
                    SSH and sudo Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="kubernetes-admission-control.html">
            
                <a href="kubernetes-admission-control.html">
            
                    
                    Kubernetes Admission Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="terraform.html">
            
                <a href="terraform.html">
            
                    
                    Terraform Testing
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".">REST API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="rest-api">REST API</h1>
<p>This document is the authoritative specification of the OPA REST API.</p>
<h2 id="policy-api"><a name="policy-api"> Policy API</a></h2>
<p>The Policy API exposes CRUD endpoints for managing policy modules. Policy modules can be added, removed, and modified at any time.</p>
<p>The identifiers given to policy modules are only used for management purposes. They are not used outside of the Policy API.</p>
<h3 id="list-policies"><a name="list-policies">List Policies</a></h3>
<pre><code>GET /v1/policies
</code></pre><p>List policy modules.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/v1/policies</span> HTTP/1.1
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;example2&quot;</span>,
      <span class="hljs-string">&quot;raw&quot;</span>: <span class="hljs-string">&quot;package opa.examples\n\nimport data.servers\n\nviolations[server] {\n\tserver = servers[_]\n\tserver.protocols[_] = \&quot;http\&quot;\n\tpublic_servers[server]\n}\n&quot;</span>,
      <span class="hljs-string">&quot;ast&quot;</span>: {
        <span class="hljs-string">&quot;package&quot;</span>: {
          <span class="hljs-string">&quot;path&quot;</span>: [
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
            },
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;opa&quot;</span>
            },
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;examples&quot;</span>
            }
          ]
        },
        <span class="hljs-string">&quot;rules&quot;</span>: [
          {
            <span class="hljs-string">&quot;head&quot;</span>: {
              <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;violations&quot;</span>,
              <span class="hljs-string">&quot;key&quot;</span>: {
                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
              }
            },
            <span class="hljs-string">&quot;body&quot;</span>: [
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;servers&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$0&quot;</span>
                      }
                    ]
                  }
                ]
              },
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">1</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;protocols&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$1&quot;</span>
                      }
                    ]
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;http&quot;</span>
                  }
                ]
              },
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">2</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;opa&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;examples&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;public_servers&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                    }
                  ]
                }
              }
            ]
          }
        ]
      }
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;example1&quot;</span>,
      <span class="hljs-string">&quot;raw&quot;</span>: <span class="hljs-string">&quot;package opa.examples\n\nimport data.servers\nimport data.networks\nimport data.ports\n\npublic_servers[server] {\n\tserver = servers[_]\n\tserver.ports[_] = ports[k].id\n\tports[k].networks[_] = networks[m].id\n\tnetworks[m].public = true\n}\n&quot;</span>,
      <span class="hljs-string">&quot;ast&quot;</span>: {
        <span class="hljs-string">&quot;package&quot;</span>: {
          <span class="hljs-string">&quot;path&quot;</span>: [
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
            },
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;opa&quot;</span>
            },
            {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;examples&quot;</span>
            }
          ]
        },
        <span class="hljs-string">&quot;rules&quot;</span>: [
          {
            <span class="hljs-string">&quot;head&quot;</span>: {
              <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;public_servers&quot;</span>,
              <span class="hljs-string">&quot;key&quot;</span>: {
                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
              }
            },
            <span class="hljs-string">&quot;body&quot;</span>: [
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;servers&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$0&quot;</span>
                      }
                    ]
                  }
                ]
              },
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">1</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$1&quot;</span>
                      }
                    ]
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;k&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;id&quot;</span>
                      }
                    ]
                  }
                ]
              },
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">2</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;k&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$2&quot;</span>
                      }
                    ]
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;m&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;id&quot;</span>
                      }
                    ]
                  }
                ]
              },
              {
                <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">3</span>,
                <span class="hljs-string">&quot;terms&quot;</span>: [
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: [
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;m&quot;</span>
                      },
                      {
                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;public&quot;</span>
                      }
                    ]
                  },
                  {
                    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;boolean&quot;</span>,
                    <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-literal">true</span>
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  ]
}
</code></pre>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>500</strong> - server error</li>
</ul>
<h3 id="get-a-policy"><a name="get-a-policy">Get a Policy</a></h3>
<pre><code>GET /v1/policies/&lt;id&gt;
</code></pre><p>Get a policy module.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/v1/policies/example1</span> HTTP/1.1
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: {
    <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;example1&quot;</span>,
    <span class="hljs-string">&quot;raw&quot;</span>: <span class="hljs-string">&quot;package opa.examples\n\nimport data.servers\nimport data.networks\nimport data.ports\n\npublic_servers[server] {\n\tserver = servers[_]\n\tserver.ports[_] = ports[k].id\n\tports[k].networks[_] = networks[m].id\n\tnetworks[m].public = true\n}\n&quot;</span>,
    <span class="hljs-string">&quot;ast&quot;</span>: {
      <span class="hljs-string">&quot;package&quot;</span>: {
        <span class="hljs-string">&quot;path&quot;</span>: [
          {
            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
            <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
          },
          {
            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
            <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;opa&quot;</span>
          },
          {
            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
            <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;examples&quot;</span>
          }
        ]
      },
      <span class="hljs-string">&quot;rules&quot;</span>: [
        {
          <span class="hljs-string">&quot;head&quot;</span>: {
            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;public_servers&quot;</span>,
            <span class="hljs-string">&quot;key&quot;</span>: {
              <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
            }
          },
          <span class="hljs-string">&quot;body&quot;</span>: [
            {
              <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">&quot;terms&quot;</span>: [
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;servers&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$0&quot;</span>
                    }
                  ]
                }
              ]
            },
            {
              <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">1</span>,
              <span class="hljs-string">&quot;terms&quot;</span>: [
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;server&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$1&quot;</span>
                    }
                  ]
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;k&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;id&quot;</span>
                    }
                  ]
                }
              ]
            },
            {
              <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">2</span>,
              <span class="hljs-string">&quot;terms&quot;</span>: [
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;ports&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;k&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;$2&quot;</span>
                    }
                  ]
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;m&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;id&quot;</span>
                    }
                  ]
                }
              ]
            },
            {
              <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">3</span>,
              <span class="hljs-string">&quot;terms&quot;</span>: [
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ref&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: [
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;data&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;networks&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;m&quot;</span>
                    },
                    {
                      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
                      <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;public&quot;</span>
                    }
                  ]
                },
                {
                  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;boolean&quot;</span>,
                  <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-literal">true</span>
                }
              ]
            }
          ]
        }
      ]
    }
  }
}
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>404</strong> - not found</li>
<li><strong>500</strong> - server error</li>
</ul>
<h3 id="create-or-update-a-policy"><a name="create-or-update-a-policy">Create or Update a Policy</a></h3>
<pre><code>PUT /v1/policies/&lt;id&gt;
Content-Type: text/plain
</code></pre><p>Create or update a policy module.</p>
<p>If the policy module does not exist, it is created. If the policy module already exists, it is replaced.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/v1/policies/example1</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: text/plain
</code></pre>
<pre><code class="lang-ruby">package opa.examples

import data.servers
import data.networks
import data.ports

public_servers[server] {
    server = servers[<span class="hljs-number">_</span>]
    server.ports[<span class="hljs-number">_</span>] = ports[k].id
    ports[k].networks[<span class="hljs-number">_</span>] = networks[m].id
    networks[m].public = <span class="hljs-keyword">true</span>
}
</code></pre>
<blockquote>
<p>cURL&apos;s <code>-d/--data</code> flag removes newline characters from input files. Use the <code>--data-binary</code> flag instead.
{: .opa-tip}</p>
</blockquote>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{}
</code></pre>
<h3 id="query-parameters">Query Parameters</h3>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
<li><strong>metrics</strong> - Return compiler performance metrics in addition to result. See <a href="#performance-metrics">Performance Metrics</a> for more detail.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>Before accepting the request, the server will parse, compile, and install the policy module. If the policy module is invalid, one of these steps will fail and the server will respond with 400. The error message in the response will be set to indicate the source of the error.</p>
<h3 id="delete-a-policy"><a name="delete-a-policy">Delete a Policy</a></h3>
<pre><code>DELETE /v1/policies/&lt;id&gt;
</code></pre><p>Delete a policy module.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/v1/policies/example2</span> HTTP/1.1
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{}
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
<li><strong>metrics</strong> - Return compiler performance metrics in addition to result. See <a href="#performance-metrics">Performance Metrics</a> for more detail.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>204</strong> - no content</li>
<li><strong>400</strong> - bad request</li>
<li><strong>404</strong> - not found</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>If other policy modules in the same package depend on rules in the policy module to be deleted, the server will return 400.</p>
<h2 id="data-api"><a name="data-api"></a> Data API</h2>
<p>The Data API exposes endpoints for reading and writing documents in OPA. For an introduction to the different types of documents in OPA see <a href="how-does-opa-work.html">How Does OPA Work?</a>.</p>
<h3 id="get-a-document"><a name="get-a-document">Get a Document</a></h3>
<pre><code>GET /v1/data/{path:.+}
</code></pre><p>Get a document.</p>
<p>The path separator is used to access values inside object and array documents. If the path indexes into an array, the server will attempt to convert the array index to an integer. If the path element cannot be converted to an integer, the server will respond with 404.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/v1/data/opa/examples/public_servers</span> HTTP/1.1
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s1&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>,
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;https&quot;</span>,
        <span class="hljs-string">&quot;ssh&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s4&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    }
  ]
}
</code></pre>
<h4 id="example-watch-request">Example Watch Request</h4>
<p>If we make the following GET request:</p>
<pre><code class="lang-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/v1/data/servers?watch&amp;pretty=true</span> HTTP/1.1
</code></pre>
<p>Followed by these PATCH requests:</p>
<pre><code class="lang-http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/v1/data/servers</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json-patch+json
</code></pre>
<pre><code class="lang-json">[
    {<span class="hljs-string">&quot;op&quot;</span>: <span class="hljs-string">&quot;add&quot;</span>,
     <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;-&quot;</span>,
     <span class="hljs-string">&quot;value&quot;</span>: {
         <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s5&quot;</span>,
         <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;job&quot;</span>,
         <span class="hljs-string">&quot;protocols&quot;</span>: [<span class="hljs-string">&quot;amqp&quot;</span>],
         <span class="hljs-string">&quot;ports&quot;</span>: [<span class="hljs-string">&quot;p3&quot;</span>]
     }}
]
</code></pre>
<pre><code class="lang-http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/v1/data/servers</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json-patch+json
</code></pre>
<pre><code class="lang-json">[
    {
     <span class="hljs-string">&quot;op&quot;</span>: <span class="hljs-string">&quot;remove&quot;</span>,
     <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>
    }
]
</code></pre>
<h4 id="example-watch-response">Example Watch Response</h4>
<p>The response below represents the response <em>after</em> the chunked encoding has been processed.
It is not complete, as further changes to <code>/data/servers</code> would cause more notifications to be streamed.</p>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
<span class="hljs-attribute">Transfer-Encoding</span>: chunked
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s1&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>,
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;https&quot;</span>,
        <span class="hljs-string">&quot;ssh&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s2&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;db&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;mysql&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s3&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;cache&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;memcache&quot;</span>,
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s4&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    }
  ]
}

{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s1&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>,
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;https&quot;</span>,
        <span class="hljs-string">&quot;ssh&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s2&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;db&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;mysql&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s3&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;cache&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;memcache&quot;</span>,
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s4&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s5&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;job&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;amqp&quot;</span>
      ]
    }
  ]
}

{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s1&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>,
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;https&quot;</span>,
        <span class="hljs-string">&quot;ssh&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s3&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;cache&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;memcache&quot;</span>,
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s4&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p1&quot;</span>,
        <span class="hljs-string">&quot;p2&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;http&quot;</span>
      ]
    },
    {
      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s5&quot;</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;job&quot;</span>,
      <span class="hljs-string">&quot;ports&quot;</span>: [
        <span class="hljs-string">&quot;p3&quot;</span>
      ],
      <span class="hljs-string">&quot;protocols&quot;</span>: [
        <span class="hljs-string">&quot;amqp&quot;</span>
      ]
    }
  ]
}
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>input</strong> - Provide an input document. Format is a JSON value that will be used as the value for the input document.</li>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
<li><strong>explain</strong> - Return query explanation in addition to result. Values: <strong>full</strong>, <strong>truth</strong>.</li>
<li><strong>metrics</strong> - Return query performance metrics in addition to result. See <a href="#performance-metrics">Performance Metrics</a> for more detail.</li>
<li><strong>watch</strong> - Set a watch on the data reference if the parameter is present. See <a href="#watches">Watches</a> for more detail.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>The server returns 400 if either:</p>
<ul>
<li>The query requires the input document and the caller does not provide it.</li>
<li>The caller provides the input document but the query already defines it programmatically.</li>
</ul>
<p>The server returns 200 if the path refers to an undefined document. In this
case, the response will not contain a <code>result</code> property.</p>
<h3 id="get-a-document-with-input"><a name="get-a-document-with-input"></a> Get a Document (with Input)</h3>
<pre><code>POST /v1/data/{path:.+}
Content-Type: application/json
</code></pre><pre><code class="lang-json">{
  <span class="hljs-string">&quot;input&quot;</span>: ...
}
</code></pre>
<p>Get a document that requires input.</p>
<p>The path separator is used to access values inside object and array documents. If the path indexes into an array, the server will attempt to convert the array index to an integer. If the path element cannot be converted to an integer, the server will respond with 404.</p>
<p>The request body contains an object that specifies a value for <a href="how-does-opa-work.html#the-input-document">The input Document</a>.</p>
<p>The examples below assume the following policy:</p>
<pre><code class="lang-ruby">package opa.examples

import input.example.flag

allow_request { flag = <span class="hljs-keyword">true</span> }
</code></pre>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/v1/data/opa/examples/allow_request</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;input&quot;</span>: {
    <span class="hljs-string">&quot;example&quot;</span>: {
      <span class="hljs-string">&quot;flag&quot;</span>: <span class="hljs-literal">true</span>
    }
  }
}
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: <span class="hljs-literal">true</span>
}
</code></pre>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/v1/data/opa/examples/allow_request</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;input&quot;</span>: {
    <span class="hljs-string">&quot;example&quot;</span>: {
      <span class="hljs-string">&quot;flag&quot;</span>: <span class="hljs-literal">false</span>
    }
  }
}
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
</code></pre>
<pre><code class="lang-json">{}
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
<li><strong>explain</strong> - Return query explanation in addition to result. Values: <strong>full</strong>, <strong>truth</strong>.</li>
<li><strong>metrics</strong> - Return query performance metrics in addition to result. See <a href="#performance-metrics">Performance Metrics</a> for more detail.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>The server returns 400 if either:</p>
<ol>
<li>The query requires an input document and the client did not supply one.</li>
<li>The query already defines an input document and the client did supply one.</li>
</ol>
<p>The server returns 200 if the path refers to an undefined document. In this
case, the response will not contain a <code>result</code> property.</p>
<h3 id="get-a-document-webhook"><a name="get-a-document-webhook">Get a Document (Webhook)</a></h3>
<pre><code>POST /v0/data/{path:.+}
Content-Type: application/json
</code></pre><p>Get a document from a webhook.</p>
<p>Use this API if you are enforcing policy decisions via webhooks that have pre-defined
request/response formats. Note, the API path prefix is <code>/v0</code> instead of <code>/v1</code>.</p>
<p>The request message body defines the content of the <a href="how-does-opa-work.html#the-input-document">The input
Document</a>. The request message body
may be empty. The path separator is used to access values inside object and
array documents.</p>
<p>The examples below assume the following policy:</p>
<pre><code class="lang-ruby">package opa.examples

import input.example.flag

allow_request { flag = <span class="hljs-keyword">true</span> }
</code></pre>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/v0/data/opa/examples/allow_request</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;example&quot;</span>: {
    <span class="hljs-string">&quot;flag&quot;</span>: <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json"><span class="hljs-literal">true</span>
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>404</strong> - not found</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>If the requested document is missing or undefined, the server will return 404 and the message body will contain an error object.</p>
<h3 id="create-or-overwrite-a-document"><a name="create-or-overwrite a document">Create or Overwrite a Document</a></h3>
<pre><code>PUT /v1/data/{path:.+}
Content-Type: application/json
</code></pre><p>Create or overwrite a document.</p>
<p>If the path does not refer to an existing document, the server will attempt to create all of the necessary containing documents. This behavior is similar in principle to the Unix command <code>mkdir -p</code>.</p>
<p>The server will respect the <code>If-None-Match</code> header if it is set to <code>*</code>. In this case, the server will not overwrite an existing document located at the path.</p>
<h4 id="example-request-to-initialize-document-with-if-none-match">Example Request To Initialize Document With If-None-Match</h4>
<pre><code class="lang-http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/v1/data/us-west/servers</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json
<span class="hljs-attribute">If-None-Match</span>: *
</code></pre>
<pre><code class="lang-json">{}
</code></pre>
<h4 id="example-response-if-document-already-exists">Example Response If Document Already Exists</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">304</span> Not Modified
</code></pre>
<h4 id="example-response-if-document-does-not-exist">Example Response If Document Does Not Exist</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">204</span> No Content
</code></pre>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>204</strong> - no content (success)</li>
<li><strong>304</strong> - not modified</li>
<li><strong>404</strong> - write conflict</li>
</ul>
<p>If the path refers to a virtual document or a conflicting base document the server will respond with 404. A base document conflict will occur if the parent portion of the path refers to a non-object document.</p>
<h3 id="patch-a-document"><a name="patch-a-document">Patch a Document</a></h3>
<pre><code>PATCH /v1/data/{path:.+}
Content-Type: application/json-patch+json
</code></pre><p>Update a document.</p>
<p>The path separator is used to access values inside object and array documents. If the path indexes into an array, the server will attempt to convert the array index to an integer. If the path element cannot be converted to an integer, the server will respond with 404.</p>
<p>The server accepts updates encoded as JSON Patch operations. The message body of the request should contain a JSON encoded array containing one or more JSON Patch operations. Each operation specifies the operation type, path, and an optional value. For more information on JSON Patch, see <a href="https://tools.ietf.org/html/rfc6902" target="_blank">RFC 6902</a>.</p>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/v1/data/servers</span> HTTP/1.1
<span class="hljs-attribute">Content-Type</span>: application/json-patch+json
</code></pre>
<pre><code class="lang-json">[
    {<span class="hljs-string">&quot;op&quot;</span>: <span class="hljs-string">&quot;add&quot;</span>,
     <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;-&quot;</span>,
     <span class="hljs-string">&quot;value&quot;</span>: {
         <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;s5&quot;</span>,
         <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;job&quot;</span>,
         <span class="hljs-string">&quot;protocols&quot;</span>: [<span class="hljs-string">&quot;amqp&quot;</span>],
         <span class="hljs-string">&quot;ports&quot;</span>: [<span class="hljs-string">&quot;p3&quot;</span>]
     }}
]
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">204</span> No Content
</code></pre>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>204</strong> - no content (success)</li>
<li><strong>404</strong> - not found</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>The effective path of the JSON Patch operation is obtained by joining the path portion of the URL with the path value from the operation(s) contained in the message body. In all cases, the parent of the effective path MUST refer to an existing document, otherwise the server returns 404. In the case of <strong>remove</strong> and <strong>replace</strong> operations, the effective path MUST refer to an existing document, otherwise the server returns 404.</p>
<h2 id="query-api"><a name="query-api"></a> Query API</h2>
<h3 id="execute-a-simple-query"><a name="execute-a-simple-query">Execute a Simple Query</a></h3>
<pre><code>POST /
Content-Type: application/json
</code></pre><p>Execute a simple query.</p>
<p>OPA serves POST requests without a URL path by querying for the document at
path <code>/data/system/main</code>. The content of that document defines the response
entirely. The example below shows how to define a rule that will produce a
value for the <code>/data/system/main</code> document.</p>
<p>The request message body is mapped to the <a href="how-does-opa-work.html#the-input-document">Input Document</a>.</p>
<pre><code class="lang-ruby">package system

main = msg {
  sprintf(<span class="hljs-string">&quot;hello, %v&quot;</span>, input.user, msg)
}
</code></pre>
<h4 id="example-request">Example Request</h4>
<pre><code class="lang-http">POST /
Content-Type: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;alice&quot;</span>
}
</code></pre>
<h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json"><span class="hljs-string">&quot;hello, alice&quot;</span>
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>404</strong> - not found</li>
<li><strong>500</strong> - server error</li>
</ul>
<p>If the <code>/data/system/main</code> document is undefined (e.g., because the administrator has not defined one) the server returns 404.</p>
<h3 id="execute-an-ad-hoc-query"><a name="execute-an-ad-hoc-query">Execute an Ad-hoc Query</a></h3>
<pre><code>GET /v1/query
</code></pre><p>Execute an ad-hoc query and return bindings for variables found in the query.</p>
<h4 id="example-request">Example Request</h4>
<pre><code>GET /v1/query?q=data.servers[i].ports[_] = &quot;p2&quot;; data.servers[i].name = name HTTP/1.1
</code></pre><h4 id="example-response">Example Response</h4>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;result&quot;</span>: [
    {
      <span class="hljs-string">&quot;i&quot;</span>: <span class="hljs-number">3</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;dev&quot;</span>
    },
    {
      <span class="hljs-string">&quot;i&quot;</span>: <span class="hljs-number">0</span>,
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;app&quot;</span>
    }
  ]
}
</code></pre>
<h4 id="query-parameters">Query Parameters</h4>
<ul>
<li><strong>q</strong> - The ad-hoc query to execute. OPA will parse, compile, and execute the query represented by the parameter value. The value MUST be URL encoded.</li>
<li><strong>pretty</strong> - If parameter is <code>true</code>, response will formatted for humans.</li>
<li><strong>explain</strong> - Return query explanation in addition to result. Values: <strong>full</strong>, <strong>truth</strong>.</li>
<li><strong>metrics</strong> - Return query performance metrics in addition to result. See <a href="#performance-metrics">Performance Metrics</a> for more detail.</li>
<li><strong>watch</strong> - Set a watch on the query if the parameter is present. See <a href="#watches">Watches</a> for more detail.</li>
</ul>
<h4 id="status-codes">Status Codes</h4>
<ul>
<li><strong>200</strong> - no error</li>
<li><strong>400</strong> - bad request</li>
<li><strong>404</strong> - watch ID not found</li>
<li><strong>500</strong> - server error</li>
<li><strong>501</strong> - streaming not implemented</li>
</ul>
<h2 id="authentication"><a name="authentication"></a> Authentication</h2>
<p>The API is secured via <a href="documentation/references/security">HTTPS, Authentication, and
Authorization</a>.</p>
<h3 id="bearer-tokens"><a name="bearer-tokens"> Bearer Tokens</a></h3>
<p>When OPA is started with the <code>--authentication=token</code> command line flag,
clients MUST provide a Bearer token in the HTTP Authorization header:</p>
<pre><code class="lang-http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/v1/data/exempli-gratia</span> HTTP/1.1
<span class="hljs-attribute">Authorization</span>: Bearer my-secret-token
</code></pre>
<p>Bearer tokens must be represented with a valid HTTP header value character
sequence.</p>
<p>OPA will extract the Bearer token value (which is set to <code>my-secret-token</code>
above) and provide it to the authorization component inside OPA that will (i)
validate the token and (ii) execute the authorization policy configured by the
admin.</p>
<h2 id="errors"><a name="errors"></a> Errors</h2>
<p>All of the API endpoints use standard HTTP status codes to indicate success or
failure of an API call. If an API call fails, the response will contain a JSON
encoded object that provides more detail. The <code>errors</code> and <code>location</code> fields are
optional:</p>
<pre><code>{
  &quot;code&quot;: &quot;invalid_parameter&quot;,
  &quot;message&quot;: &quot;error(s) occurred while compiling module(s)&quot;,
  &quot;errors&quot;: [
    {
      &quot;code&quot;: &quot;rego_unsafe_var_error&quot;,
      &quot;message&quot;: &quot;var x is unsafe&quot;,
      &quot;location&quot;: {
        &quot;file&quot;: &quot;example&quot;,
        &quot;row&quot;: 3,
        &quot;col&quot;: 1
      }
    }
  ]
}
</code></pre><h2 id="explanations"><a name="explanations"></a> Explanations</h2>
<p>OPA supports query explanations that describe (in detail) the steps taken to
produce query results.</p>
<p>Explanations can be requested for:</p>
<ul>
<li><a href="#data-api">Data API</a> GET queries</li>
<li><a href="#query-api">Query API</a> queries</li>
</ul>
<p>Explanations are requested by setting the <code>explain</code> query parameter to one of
the following values:</p>
<ul>
<li><strong>full</strong> - returns a full query trace containing every step in the query evaluation process.</li>
<li><strong>truth</strong> - returns a partial query trace containing one path that leads to the overall query being successful.</li>
</ul>
<p>By default, explanations are represented in a machine-friendly format. Set the
<code>pretty</code> parameter to request a human-friendly format for debugging purposes.</p>
<h3 id="trace-events"><a name="trace-events">Trace Events</a></h3>
<p>When the <code>explain</code> query parameter is set to <strong>full</strong> or <strong>truth</strong> , the
response contains an array of Trace Event objects.</p>
<p>Trace Event objects contain the following fields:</p>
<ul>
<li><strong>op</strong> - identifies the kind of Trace Event. Values: <strong>&quot;Enter&quot;</strong>, <strong>&quot;Exit&quot;</strong>, <strong>&quot;Eval&quot;</strong>, <strong>&quot;Fail&quot;</strong>, <strong>&quot;Redo&quot;</strong>.</li>
<li><strong>query_id</strong> - uniquely identifies the query that the Trace Event was emitted for.</li>
<li><strong>parent_id</strong> - identifies the parent query.</li>
<li><strong>type</strong> - indicates the type of the <strong>node</strong> field. Values: <strong>&quot;expr&quot;</strong>, <strong>&quot;rule&quot;</strong>, <strong>&quot;body&quot;</strong>.</li>
<li><strong>node</strong> - contains the AST element associated with the evaluation step.</li>
<li><strong>locals</strong> - contains the term bindings from the query at the time when the Trace Event was emitted.</li>
</ul>
<h4 id="query-ids">Query IDs</h4>
<p>Queries often reference rules or contain comprehensions. In both cases, query
evaluation involves evaluation of one or more other queries, e.g., the body of
the rule or comprehension.</p>
<p>Trace Events from different queries can be distinguished by the <strong>query_id</strong>
field.</p>
<p>Trace Events from related queries can be identified by the <strong>parent_id</strong> field.</p>
<p>For example, if query A references a rule R, Trace Events emitted as part of
evaluating rule R&apos;s body will have the <strong>parent_id</strong> field set to query A&apos;s
<strong>query_id</strong>.</p>
<h4 id="types-of-events">Types of Events</h4>
<p>Each Trace Event represents a step in the query evaluation process. Trace Events
are emitted at the following points:</p>
<ul>
<li><strong>enter</strong> - before a body or rule is evaluated.</li>
<li><strong>exit</strong> - after a body or rule has evaluated successfully.</li>
<li><strong>eval</strong> - before an expression is evaluated.</li>
<li><strong>fail</strong> - after an expression has evaluated to false.</li>
<li><strong>redo</strong> - before evaluation restarts from a body, rule, or expression.</li>
</ul>
<p>By default, OPA searches for all sets of term bindings that make all expressions
in the query evaluate to true. Because there may be multiple answers, the search
can <em>restart</em> when OPA determines the query is true or false. When the search
restarts, a <strong>Redo</strong> Trace Event is emitted.</p>
<h4 id="example-trace-event">Example Trace Event</h4>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;op&quot;</span>: <span class="hljs-string">&quot;eval&quot;</span>,
  <span class="hljs-string">&quot;query_id&quot;</span>: <span class="hljs-number">20</span>,
  <span class="hljs-string">&quot;parent_id&quot;</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;expr&quot;</span>,
  <span class="hljs-string">&quot;node&quot;</span>: {
    <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&quot;terms&quot;</span>: [
      {
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;eq&quot;</span>
      },
      {
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;x&quot;</span>
      },
      {
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;y&quot;</span>
      }
    ]
  },
  <span class="hljs-string">&quot;locals&quot;</span>: [
    {
      <span class="hljs-string">&quot;key&quot;</span>: {
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;var&quot;</span>,
        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;x&quot;</span>
      },
      <span class="hljs-string">&quot;value&quot;</span>: {
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,
        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;hello&quot;</span>
      }
    }
  ]
}
</code></pre>
<h2 id="performance-metrics"><a name="performance-metrics"></a> Performance Metrics</h2>
<p>OPA can report detailed performance metrics at runtime. Currently, performance metrics can be requested on individual API calls and are returned inline with the API response. To enable performance metric collection on an API call, specify the <code>metrics=true</code> query parameter when executing the API call. Performance metrics are currently supported for the following APIs:</p>
<ul>
<li>Data API GET</li>
<li>Data API POST</li>
<li>Query API</li>
</ul>
<p>For example:</p>
<pre><code class="lang-http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/v1/data/example?metrics=true</span> HTTP/1.1
</code></pre>
<p>Response:</p>
<pre><code class="lang-http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Content-Type</span>: application/json
</code></pre>
<pre><code class="lang-json">{
  <span class="hljs-string">&quot;metrics&quot;</span>: {
    <span class="hljs-string">&quot;timer_rego_query_compile_ns&quot;</span>: <span class="hljs-number">69994</span>,
    <span class="hljs-string">&quot;timer_rego_query_eval_ns&quot;</span>: <span class="hljs-number">48425</span>,
    <span class="hljs-string">&quot;timer_rego_query_parse_ns&quot;</span>: <span class="hljs-number">4096</span>
  },
  <span class="hljs-string">&quot;result&quot;</span>: {
    <span class="hljs-string">&quot;some_strings&quot;</span>: [
      <span class="hljs-string">&quot;hello&quot;</span>,
      <span class="hljs-string">&quot;world&quot;</span>
    ]
  }
}
</code></pre>
<p>OPA currently supports the following query performance metrics:</p>
<ul>
<li><strong>timer_rego_query_parse_ns</strong>: time taken (in nanonseconds) to parse the query.</li>
<li><strong>timer_rego_query_compile_ns</strong>: time taken (in nanonseconds) to compile the query.</li>
<li><strong>timer_rego_query_eval_ns</strong>: time taken (in nanonseconds) to evaluate the query.</li>
<li><strong>timer_rego_module_parse_ns</strong>: time taken (in nanoseconds) to parse the input policy module.</li>
<li><strong>timer_rego_module_compile_ns</strong>: time taken (in nanoseconds) to compile the loaded policy modules.</li>
</ul>
<h2 id="diagnostics"><a name="diagnostics"></a> Diagnostics</h2>
<p>The OPA server has the capability to log and return diagnostics on past requests to the user. By default, the server will not log any diagnostics at all. In order to have the server start logging diagnostic information, the document located at <code>data.system.diagnostics.config</code> (referred to as config below) must be defined. The config must evaluate to an object that is structured as follows:</p>
<pre><code>{
    &quot;mode&quot;: &lt;&quot;all&quot;/&quot;on&quot;/&quot;off&quot;&gt;,
}
</code></pre><p>An example of a policy that defines a simple diagnostics config that only logs GET requests:</p>
<pre><code>package system.diagnostics

default config = {&quot;mode&quot;: &quot;off&quot;}

config = {&quot;mode&quot;: &quot;on&quot;} {
    input.method = &quot;GET&quot;
}
</code></pre><p>If the config document does not conform to the structure above, then diagnostics are automatically disabled.</p>
<p>Whenever a data GET/POST, a POST to <code>/</code> or query GET request is received by the server, it evaluates the config document to determine whether or not diagnostics should be logged. The table below describes the behavior of diagnostics depending on the values of the config fields.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mode</code></td>
<td>&quot;off&quot;</td>
<td>No diagnostics are recorded.</td>
</tr>
<tr>
<td><code>mode</code></td>
<td>&quot;on&quot;</td>
<td>Enables collection of inexpensive values. This includes the query, input, result, and performance metrics.</td>
</tr>
<tr>
<td><code>mode</code></td>
<td>&quot;all&quot;</td>
<td>All diagnostics are collected. This includes a full trace of the query evaluation.</td>
</tr>
</tbody>
</table>
<p>In order to allow the config document to make dynamic decisions about whether or not to record diagnostics for a given request, the server will provide a special input document when evaluating it. The input document will contain information from the HTTP request that was issued to the server, of the form:</p>
<pre><code>{
    &quot;method&quot;: &lt;HTTP request method&gt;,
    &quot;path&quot;: &lt;Full HTTP request path&gt;,
    &quot;body&quot;: &lt;HTTP request body (null if not present or invalid JSON)&gt;,

    # The query parameters in the HTTP request.
    &quot;params&quot;: {
        &quot;param0&quot;: [&quot;value0&quot;, &quot;value1&quot;, ...],
        &quot;param1&quot;: [...],
        ...
    },

    # The header fields in the HTTP request.
    &quot;header&quot;: {
        &quot;field0&quot;: [&quot;value0&quot;, &quot;value1&quot;, ...],
        &quot;field1&quot;: [...],
        ...
    }
}
</code></pre><p>As an example, the request <code>GET /v1/data/servers?watch&amp;pretty=true HTTP/1.1</code> would result in the input document below (the headers will likely depend on the client used to send the request):</p>
<pre><code>{
    &quot;method&quot;: &quot;GET&quot;,
    &quot;path&quot;: &quot;/v1/data/servers&quot;,
    &quot;body&quot;: null,
    &quot;params&quot;: {
      &quot;watch&quot;: [&quot;&quot;],
      &quot;pretty&quot;: [&quot;true&quot;],
    },

    &quot;header&quot;: { ... }
}
</code></pre><p>Diagnostics may be fetched from the server using the Data GET endpoint. When the server sees a GET request to <code>/v1/data/system/diagnostics</code>, it will not evaluate the document located there, but instead return a list of the diagnostics stored on the server (ordered from oldest to newest). The server will honor the <code>explainMode</code> and <code>pretty</code> parameters from the GET request, but the others will be ignored. The response is of the form:</p>
<pre><code>{
  &quot;result&quot;: [
    {
      &quot;timestamp&quot;: ...,
      &quot;query&quot;: ...,
      &quot;input&quot;: ...,
      &quot;result&quot;: ...,
      &quot;error&quot;: ...,
      &quot;explanation&quot;: ...,
      &quot;metrics&quot;: ...
    },
    ...
  ]
}
</code></pre><table>
<thead>
<tr>
<th>Field</th>
<th>Always Present</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>timestamp</code></td>
<td>Yes</td>
<td>Nanoseconds since the Unix Epoch time</td>
</tr>
<tr>
<td><code>query</code></td>
<td>Yes</td>
<td>The query, if the request for the record was a query request. Otherwise the data path from the original request.</td>
</tr>
<tr>
<td><code>input</code></td>
<td>No</td>
<td>Input provided to the <code>query</code> at evaluation time.</td>
</tr>
<tr>
<td><code>result</code></td>
<td>No</td>
<td>Result of evaluating <code>query</code>. See the <a href="#data-api">Data</a> and <a href="#query-api">Query</a> APIs for detailed descriptions of formats.</td>
</tr>
<tr>
<td><code>error</code></td>
<td>No</td>
<td><a href="#errors">Error</a> encountered while evaluating <code>query</code>.</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>No</td>
<td><a href="#performance-metrics">Performance Metrics</a> for <code>query</code>.</td>
</tr>
<tr>
<td><code>explanation</code></td>
<td>No</td>
<td><a href="#explanations">Explanation</a> of how <code>result</code> was found. Whether it contains a <code>truth</code> level or <code>full</code> level explanation depends on the explanation mode in the GET request that requested the diagnostics.</td>
</tr>
</tbody>
</table>
<p>The server will only store a finite number of diagnostics. If the server&apos;s diagnostics storage becomes full, it will delete the oldest diagnostic to make room for the new one. The size of the storage may be configured when the server is started.</p>
<h2 id="watches"><a name="watches"></a> Watches</h2>
<p>OPA can set watches on queries and report whenever the result of evaluating the query has changed. When a watch is set on a query, the requesting connection will be maintained as the query results are streamed back in HTTP Chunked Encoding format. A notification reflecting a certain change to the query results will be delivered <em>at most once</em>. That is, if a watch is set on <code>data.x</code>, and then multiple writes are made to <code>data.x</code>, say <code>1</code>, <code>2</code> and <code>3</code>, only the notification reflecting <code>data.x=3</code> is always seen eventually (assuming the watch is not ended, there are no connection problems, etc). The notifications reflecting <code>data.x=1</code> and <code>data.x=2</code> <em>might</em> be seen. However, the notifications sent are guaranteed to be in order (<code>data.x=2</code> will always come after <code>data.x=1</code>, if it comes).</p>
<p>The notification stream will not be delimited by any value; the client is expected to be able to parse JSON values from the stream one by one, recognizing where one ends and the next begins.</p>
<p>The notification stream is a stream of JSON objects, each of which has the following structure:</p>
<pre><code>{
    &quot;result&quot;: &lt;result&gt;,
    &quot;error&quot;: &lt;error&gt;,
    &quot;metrics&quot;: &lt;metrics&gt;,
    &quot;explanation&quot;: &lt;explanation&gt;,
}
</code></pre><p>The <code>error</code> field is optional; it is omitted when no errors occur. If it is present, it is an <a href="#errors">Error</a> describing any errors encountered while evaluating the query the watch was set on. If the policies on the server are changed such that the query no longer compiles, the contents of the error&apos;s <code>message</code> field will start with the text &quot;watch invalidated:&quot; and will be followed with the reason for invalidation. The watch will be ended by the server and the stream closed.</p>
<p>The <code>metrics</code> field represents <a href="#performance-metrics">Performance Metrics</a> for the evaluation of the query. It will only be present if metrics were requested in the API call that started the watch.</p>
<p>The <code>explanation</code> field represents an <a href="#explanations">Explanation</a> of how the query answer was found. It will only be present if explanations were requested in the API call that started the watch.</p>
<p>If there are no errors, the <code>result</code> field will be a JSON array of the results of evaluating the query. The format of a result is:</p>
<pre><code>{
    &quot;expressions&quot;: [
        {
            &quot;value&quot;: true,
            &quot;text&quot;: &quot;a = data.x&quot;,
            &quot;location&quot;:{&quot;row&quot;:1,&quot;col&quot;:1}
        },
        ...
    ],
    &quot;bindings&quot;: {...}
}
</code></pre><p>The <code>expressions</code> field is an array of the results of evaluating each of the expressions in the query. <code>value</code> is the expression&apos;s value, <code>text</code> is the actual expression, and <code>location</code> describes the location of the expression within the query. The values above are examples.</p>
<p>The <code>bindings</code> field is a JSON object mapping <code>string</code>s to JSON values that describe the variable bindings resulting from evaluating the query.</p>
<p>If the watch was set on a data reference instead of a query, the <code>result</code> field will simply be the value of the document requested, instead of an array of values.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching &quot;<span class="search-query"></span>&quot;</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching &quot;<span class="search-query"></span>&quot;</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="language-reference.html#grammar" class="navigation navigation-prev " aria-label="Previous page: Grammar">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="rest-api.html#policy-api" class="navigation navigation-next " aria-label="Next page: Policy API">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"REST API","level":"1.5","depth":1,"next":{"title":"Policy API","level":"1.5.1","depth":2,"anchor":"#policy-api","path":"rest-api.md","ref":"rest-api.md#policy-api","articles":[{"title":"List Policies","level":"1.5.1.1","depth":3,"anchor":"#list-policies","path":"rest-api.md","ref":"rest-api.md#list-policies","articles":[]},{"title":"Get a Policy","level":"1.5.1.2","depth":3,"anchor":"#get-a-policy","path":"rest-api.md","ref":"rest-api.md#get-a-policy","articles":[]},{"title":"Create or Update a Policy","level":"1.5.1.3","depth":3,"anchor":"#create-or-update-a-policy","path":"rest-api.md","ref":"rest-api.md#create-or-update-a-policy","articles":[]},{"title":"Delete a Policy","level":"1.5.1.4","depth":3,"anchor":"#delete-a-policy","path":"rest-api.md","ref":"rest-api.md#delete-a-policy","articles":[]}]},"previous":{"title":"Grammar","level":"1.4.3","depth":2,"anchor":"#grammar","path":"language-reference.md","ref":"language-reference.md#grammar","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["header","addcssjs","collapsible-menu","custom-favicon","ga","-fontsettings"],"pluginsConfig":{"collapsible-menu":{},"search":{},"layout":{"headerPath":"layouts/header.html"},"addcssjs":{"css":[],"js":["js/custom.js"]},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"header":{},"highlight":{},"favicon":"images/favicon.png","custom-favicon":{},"ga":{"configuration":"auto","token":"UA-84550302-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"rest-api.md","mtime":"2017-10-13T22:25:04.253Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-10-13T22:26:43.917Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    
    <script type="text/javascript" src="js/custom.js"></script>
    

    </body>
</html>

